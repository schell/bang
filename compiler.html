<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8">
        <title>bang::compiler</title>
        <script type="text/javascript" charset="utf-8" src="http://schell.github.com/mod/mod.js"></script>
    </head>
    <body id="compiler">
        <script type="text/javascript" charset="utf-8">
            mod.useTagInjection = true;
            mod.expansions = {
                bang : 'src/'
            };
            
            mod({
                name : 'main',
                dependencies : [ 'bang::Utils/PNGEncoder.js' ],
                init : function initCompiler (m) {
                    /** * *
                    * Initializes the Compiler 
                    * @param - m Object - The mod modules object.
                    * * **/
                    var compiler = document.createElement('div');
                    var header = document.createElement('h2');
                    header.innerHTML = 'Enter your code into and click outside the textarea to compile...';
                    var output = document.createElement('div');
                    var png = false;
                    var textArea = document.createElement('textarea');
                    textArea.cols = 45;
                    textArea.rows = 10;
                    textArea.onchange = function() {
                        var src = textArea.value;
                        if (png) {
                            output.removeChild(png);
                        }
                        png = m.PNGEncoder.PNGFromString(src);
                        output.appendChild(png);
                    };
                    compiler.appendChild(header);
                    compiler.appendChild(textArea);
                    compiler.appendChild(output);
                    // Setup setParentElement so bang.js can unpack this...
                    compiler.setParentElement = function (element) {
                        element.appendChild(m.main);
                    };
                    
                    return compiler;
                }
            }).onload(function(m) {
                m.main.setParentElement(document.body);
            });
        </script>
    </body>
</html>